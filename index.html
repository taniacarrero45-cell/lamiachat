<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>ARENA CINEMA 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gun/0.2020.1239/gun.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        #col-sx { width: 180px; border-right: 2px solid #ff00ff; background: #050505; display: flex; flex-direction: column; }
        #col-cx { flex: 1; display: flex; flex-direction: column; border-right: 2px solid #00f2ff; }
        #col-dx { width: 340px; background: #0a0a0a; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        
        .header { padding: 15px; text-align: center; color: #ff00ff; font-weight: bold; border-bottom: 1px solid #222; font-size: 14px; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; }
        .msg { margin-bottom: 8px; padding: 8px; background: #111; border-radius: 5px; border-left: 3px solid #00f2ff; }
        
        .box-regia { background: #1a1a1a; padding: 15px; border-radius: 10px; border: 1px solid #333; }
        iframe { width: 100%; aspect-ratio: 16/9; border: 2px solid #00f2ff; border-radius: 8px; background: #000; }
        
        input, button { padding: 10px; border-radius: 5px; border: none; outline: none; }
        input { background: #111; color: #fff; border: 1px solid #444; width: calc(100% - 22px); margin-bottom: 5px; }
        button { background: #ff00ff; color: #fff; font-weight: bold; cursor: pointer; width: 100%; }
        
        #login { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .u-list-item { padding: 8px; color: #00f2ff; font-size: 13px; border-bottom: 1px solid #111; }
    </style>
</head>
<body>

<div id="login">
    <div style="border: 2px solid #ff00ff; padding: 40px; border-radius: 20px; text-align: center; background: #0a0a0a;">
        <h2 style="color:#00f2ff">ARENA LIVE</h2>
        <input type="text" id="nick" placeholder="Nickname..."><br><br>
        <button onclick="entra()">ENTRA</button>
    </div>
</div>

<div id="col-sx">
    <div class="header">ONLINE</div>
    <div id="u-list"></div>
</div>

<div id="col-cx">
    <div id="chat"></div>
    <div style="padding: 15px; background: #080808; display: flex; gap: 5px;">
        <input type="text" id="msg-in" style="flex:1" placeholder="Scrivi messaggio..." onkeypress="if(event.key==='Enter') invia()">
        <button onclick="invia()" style="width: 80px;">OK</button>
    </div>
</div>

<div id="col-dx">
    <div class="box-regia">
        <div style="color:#00f2ff; font-size:12px; margin-bottom:5px;">REGIA VIDEO (Incolla Link YouTube)</div>
        <input type="text" id="video-url" placeholder="Incolla link video qui...">
        <button onclick="cambiaVideo()" style="background:#00f2ff; color:#000;">AGGIORNA VIDEO</button>
    </div>

    <div id="video-container">
        <iframe id="player" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
    
    <div class="box-regia" style="text-align: center;">
        <div style="color:gold; font-weight:bold;">üé≤ GIOCO DADI</div>
        <div id="dado-area" style="font-size: 24px; margin: 5px;">--</div>
        <button onclick="lanciaDadi()" style="background:#444;">LANCIA</button>
    </div>

    <button onclick="alert('Permesso camera richiesto...')" style="background:#ff0055;">üé• ATTIVA CAM</button>
</div>

<script>
    const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
    const db = gun.get('arena_power_2026_new');
    let mioNick = "";

    function entra() {
        mioNick = document.getElementById('nick').value.trim();
        if(mioNick) {
            document.getElementById('login').style.display = 'none';
            db.get('utenti').get(mioNick).put({n: mioNick, online: true});
        }
    }

    function invia() {
        let t = document.getElementById('msg-in').value;
        if(t) db.get('messaggi').set({u: mioNick, t: t});
        document.getElementById('msg-in').value = "";
    }

    function cambiaVideo() {
        let url = document.getElementById('video-url').value;
        let id = "";
        if(url.includes('v=')) id = url.split('v=')[1].split('&')[0];
        else if(url.includes('be/')) id = url.split('be/')[1].split('?')[0];
        
        if(id) {
            db.get('video').put({id: id});
        } else {
            alert("Link non valido! Incolla un link di YouTube.");
        }
    }

    function lanciaDadi() {
        const d = Math.floor(Math.random() * 6) + 1;
        db.get('messaggi').set({u: 'ARENA', t: mioNick + " ha lanciato un dado: " + d});
        document.getElementById('dado-area').innerText = "üé≤ " + d;
    }

    // LISTENER VIDEO
    db.get('video').on(data => {
        if(data && data.id) {
            document.getElementById('player').src = "https://www.youtube.com/embed/" + data.id + "?autoplay=1";
        }
    });

    // LISTENER CHAT
    db.get('messaggi').map().once(d => {
        if(!d) return;
        let div = document.createElement('div');
        div.className = 'msg';
        div.innerHTML = `<b style="color:#00f2ff">${d.u}:</b> ${d.t}`;
        document.getElementById('chat').appendChild(div);
        document.getElementById('chat').scrollTop = 9999;
    });

    // LISTENER UTENTI
    db.get('utenti').map().on((d, id) => {
        if(d && !document.getElementById('u-'+id)) {
            let u = document.createElement('div');
            u.id = 'u-'+id; u.className = 'u-list-item';
            u.innerText = "‚óè " + id;
            document.getElementById('u-list').appendChild(u);
        }
    });
</script>
</body>
</html>
