<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>ARENA LIVE 2026 - FULL ACCESS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gun/0.2020.1239/gun.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        #col-sx { width: 200px; border-right: 2px solid #ff00ff; background: #050505; display: flex; flex-direction: column; }
        #col-cx { flex: 1; display: flex; flex-direction: column; }
        #col-dx { width: 350px; border-left: 2px solid #00f2ff; background: #050505; padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        
        .header { padding: 15px; text-align: center; color: #ff00ff; font-weight: bold; border-bottom: 1px solid #222; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; }
        .msg { margin-bottom: 10px; padding: 10px; background: #111; border-radius: 8px; border-left: 4px solid #00f2ff; }
        
        .box-media { background: #111; border: 1px solid #333; border-radius: 10px; overflow: hidden; }
        iframe { width: 100%; aspect-ratio: 16/9; border: none; background: #000; }
        
        input { background: #111; color: #fff; border: 1px solid #444; padding: 12px; border-radius: 8px; margin: 10px; }
        button { background: #ff00ff; color: #fff; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        #login { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .user-online { padding: 10px; color: #00f2ff; border-bottom: 1px solid #111; font-size: 14px; }
    </style>
</head>
<body>

<div id="login">
    <div style="border: 2px solid #ff00ff; padding: 50px; border-radius: 20px; text-align: center; background: #0a0a0a;">
        <h2 style="color:#00f2ff">ENTRA NELL'ARENA</h2>
        <input type="text" id="nick" placeholder="Tuo Nickname..."><br>
        <button onclick="entra()" style="width: 80%">ENTRA</button>
    </div>
</div>

<div id="col-sx">
    <div class="header">UTENTI</div>
    <div id="lista-u"></div>
</div>

<div id="col-cx">
    <div id="chat"></div>
    <div style="padding: 15px; background: #0a0a0a; display: flex; gap: 10px;">
        <input type="text" id="input-m" style="flex:1" placeholder="Scrivi...">
        <button onclick="invia()" style="width: 100px;">INVIA</button>
    </div>
</div>

<div id="col-dx">
    <div class="header" style="color:#00f2ff">ARENA TV</div>
    <div class="box-media">
        <iframe id="video" src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1&mute=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
    
    <div class="box-media" style="padding: 15px; text-align: center;">
        <h3 style="color:gold; margin:0;">üé≤ GIOCO DADI</h3>
        <div id="dadi-res" style="font-size: 30px; margin: 10px;">--</div>
        <button onclick="gioca()" style="background:#444; width:100%">LANCIA DADI</button>
    </div>

    <button onclick="attivaCam()" style="background:#ff0055; padding:15px; border-radius:10px; color:#fff; font-weight:bold; border:none; cursor:pointer;">üé• ATTIVA WEBCAM</button>
</div>

<script>
    const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
    const db = gun.get('arena_globale_v2026');
    let mioNick = "";

    function entra() {
        mioNick = document.getElementById('nick').value.trim();
        if(mioNick) {
            document.getElementById('login').style.display = 'none';
            db.get('utenti').get(mioNick).put({nome: mioNick, attivo: true});
        }
    }

    function invia() {
        let t = document.getElementById('input-m').value;
        if(t) db.get('messaggi').set({u: mioNick, t: t});
        document.getElementById('input-m').value = "";
    }

    function gioca() {
        const d1 = Math.floor(Math.random() * 6) + 1;
        const d2 = Math.floor(Math.random() * 6) + 1;
        document.getElementById('dadi-res').innerText = d1 + " + " + d2;
        db.get('messaggi').set({u: "SISTEMA", t: mioNick + " ha lanciato i dadi e ha fatto " + (d1+d2)});
    }

    function attivaCam() {
        navigator.mediaDevices.getUserMedia({video: true})
        .then(() => alert("Webcam pronta! (Sistema di streaming in caricamento)"))
        .catch(() => alert("Errore: controlla i permessi della fotocamera"));
    }

    // LISTENER CHAT
    db.get('messaggi').map().once(d => {
        if(!d) return;
        let div = document.createElement('div');
        div.className = 'msg';
        div.innerHTML = `<b style="color:#00f2ff">${d.u}:</b> ${d.t}`;
        document.getElementById('chat').appendChild(div);
        document.getElementById('chat').scrollTop = 9999;
    });

    // LISTENER UTENTI
    db.get('utenti').map().on((d, id) => {
        if(d && !document.getElementById('u-'+id)) {
            let u = document.createElement('div');
            u.id = 'u-'+id; u.className = 'user-online';
            u.innerText = "‚óè " + id;
            document.getElementById('lista-u').appendChild(u);
        }
    });
</script>
</body>
</html>
