<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARENA PRO 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gun/0.2020.1239/gun.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        body { margin: 0; background: #050505; color: #eee; font-family: 'Inter', sans-serif; display: flex; height: 100vh; }
        #login { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .box-login { background: #111; padding: 40px; border: 2px solid #00f2ff; border-radius: 20px; text-align: center; }
        #sx { width: 250px; border-right: 1px solid #222; background: #0a0a0a; display: flex; flex-direction: column; }
        #main { flex: 1; display: flex; flex-direction: column; position: relative; }
        #dx { width: 350px; border-left: 1px solid #222; background: #0a0a0a; padding: 10px; }
        #yt-player { width: 100%; height: 250px; background: #000; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; background: rgba(255,255,255,0.02); }
        .msg { margin-bottom: 10px; padding: 8px; border-radius: 5px; background: #1a1a1a; border-left: 3px solid #00f2ff; }
        .privato { border-left-color: #ff00ff !important; background: #221122 !important; }
        .u-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #111; color: #00f2ff; }
        .u-item:hover { background: #111; }
        input { background: #111; color: #fff; border: 1px solid #333; padding: 12px; border-radius: 8px; width: 80%; }
        button { background: #00f2ff; color: #000; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #game-area { height: 100px; background: #111; border-top: 1px dashed #333; padding: 10px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="login">
    <div class="box-login">
        <h1 style="color:#00f2ff">ARENA PRO</h1>
        <input type="text" id="nick" placeholder="Tuo Nickname..."><br><br>
        <button onclick="inizia()">ENTRA NELL'ARENA</button>
    </div>
</div>

<div id="sx">
    <h3 style="text-align:center; color:gold;">ONLINE</h3>
    <div id="u-list"></div>
    <div style="margin-top:auto; padding:10px; font-size:10px; color:#444;">ARENA V.2.0</div>
</div>

<div id="main">
    <div id="yt-player"></div>
    <div id="chat"></div>
    <div id="game-area">
        <div id="quiz-txt">Attesa prossimo round...</div>
    </div>
    <div style="padding:15px; display:flex; gap:5px;">
        <input type="text" id="m-in" placeholder="Scrivi a tutti (o clicca un nome per il privato)...">
        <button onclick="invia()">INV</button>
    </div>
</div>

<div id="dx">
    <button onclick="toggleCam()" style="width:100%; background:#ff0055; color:white; margin-bottom:10px;">ðŸŽ¥ WEBCAM ON/OFF</button>
    <div id="videos"></div>
</div>

<script>
    let mioNick = "";
    let targetPrivato = null;
    const gun = Gun(['https://gun-manhattan.herokuapp.com/gun']);
    const db = gun.get('arena_globale_2026_pro');

    function inizia() {
        mioNick = document.getElementById('nick').value.trim();
        if(!mioNick) return alert("Metti un nome!");
        document.getElementById('login').style.display = 'none';
        db.get('utenti').get(mioNick).put({nome: mioNick, last: Date.now()});
    }

    // LISTA UTENTI
    db.get('utenti').map().on((d, id) => {
        if(!d || !d.nome) return;
        let el = document.getElementById('u-'+id);
        if(!el) {
            el = document.createElement('div'); el.id = 'u-'+id; el.className = 'u-item';
            el.onclick = () => { targetPrivato = id; document.getElementById('m-in').placeholder = "PRIVATO a " + id; };
            document.getElementById('u-list').appendChild(el);
        }
        el.innerText = "â— " + d.nome;
    });

    // CHAT E PRIVATA
    function invia() {
        let msg = document.getElementById('m-in').value;
        if(!msg) return;
        if(targetPrivato) {
            db.get('priv').get(targetPrivato).get(mioNick).set({da: mioNick, t: msg});
            targetPrivato = null;
            document.getElementById('m-in').placeholder = "Invia un messaggio...";
        } else {
            db.get('chat').set({u: mioNick, t: msg, tempo: Date.now()});
        }
        document.getElementById('m-in').value = "";
    }

    db.get('chat').map().once(d => {
        if(!d) return;
        let div = document.createElement('div');
        div.className = 'msg';
        div.innerHTML = `<b style="color:#00f2ff">${d.u}:</b> ${d.t}`;
        document.getElementById('chat').appendChild(div);
        document.getElementById('chat').scrollTop = 9999;
    });

    // SISTEMA YOUTUBE (Video di test: Lofi Beats)
    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', {
            videoId: 'jfKfPfyJRdk',
            playerVars: { 'autoplay': 1, 'controls': 1 },
            events: { 'onReady': (e) => e.target.mute() }
        });
    }
</script>
</body>
</html>
